<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-comment">-- or, on GHCI:</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- &gt; :set -XOverloadedStrings</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">{-|
Module      : Database
Description : This module includes all the main functions necessary to manipulate the database on a high-level
-}</span><span>
</span><span id="line-10"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Database</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Functions</span></span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Database.html#initialiseDB"><span class="hs-identifier">initialiseDB</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>    </span><span class="annot"><a href="Database.html#getOrCreateMovie"><span class="hs-identifier">getOrCreateMovie</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><a href="Database.html#getLastElement"><span class="hs-identifier">getLastElement</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Database.html#getOrCreateActor"><span class="hs-identifier">getOrCreateActor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Database.html#iterateCast"><span class="hs-identifier">iterateCast</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Database.html#getOrCreateGenre"><span class="hs-identifier">getOrCreateGenre</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Database.html#iterateGenre"><span class="hs-identifier">iterateGenre</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Database.html#createRecord"><span class="hs-identifier">createRecord</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Database.html#saveRecords"><span class="hs-identifier">saveRecords</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Database.html#databaseQueries"><span class="hs-identifier">databaseQueries</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Database.html#extractActorResults"><span class="hs-identifier">extractActorResults</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Database.html#extractGenreResults"><span class="hs-identifier">extractGenreResults</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Database.html#queryMovie"><span class="hs-identifier">queryMovie</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Database.html#queryActor"><span class="hs-identifier">queryActor</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Database.html#queryGenre"><span class="hs-identifier">queryGenre</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>    </span><span class="annot"><a href="Database.html#queryYear"><span class="hs-identifier">queryYear</span></a></span><span>
</span><span id="line-28"></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Types.html"><span class="hs-identifier">Types</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Database.SQLite.Simple</span></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Database.SQLite.Simple.ToField</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-comment">-- |The 'initialiseDB' function prepares a database in the `movies.sqlite` file to be used by the app</span><span>
</span><span id="line-36"></span><span class="annot"><a href="Database.html#initialiseDB"><span class="hs-identifier hs-type">initialiseDB</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span>
</span><span id="line-37"></span><span id="initialiseDB"><span class="annot"><span class="annottext">initialiseDB :: IO Connection
</span><a href="Database.html#initialiseDB"><span class="hs-identifier hs-var hs-var">initialiseDB</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-38"></span><span>        </span><span id="local-6989586621679100271"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100271"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Connection
</span><span class="hs-identifier hs-var">open</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;movies.sqlite&quot;</span></span><span>
</span><span id="line-39"></span><span>        </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><span class="hs-identifier hs-var">execute_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100271"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;CREATE TABLE IF NOT EXISTS actors (\
            \id INTEGER PRIMARY KEY AUTOINCREMENT, \
            \first_name VARCHAR(80), \
            \last_name VARCHAR(80) \
            \)&quot;</span></span><span>
</span><span id="line-44"></span><span>        </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><span class="hs-identifier hs-var">execute_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100271"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;CREATE TABLE IF NOT EXISTS movies (\
            \id INTEGER PRIMARY KEY AUTOINCREMENT,\
            \title VARCHAR(80) NOT NULL, \
            \year INT DEFAULT NULL \
            \)&quot;</span></span><span>
</span><span id="line-49"></span><span>        </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><span class="hs-identifier hs-var">execute_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100271"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;CREATE TABLE IF NOT EXISTS movie_genre (\
            \fk_movie_genre INTEGER, \
            \fk_genre_genre INTEGER \
            \)&quot;</span></span><span>
</span><span id="line-53"></span><span>        </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><span class="hs-identifier hs-var">execute_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100271"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;CREATE TABLE IF NOT EXISTS cast (\
            \fk_movie_cast INTEGER, \
            \fk_movie_actor INTEGER \
            \)&quot;</span></span><span>
</span><span id="line-57"></span><span>        </span><span class="annot"><span class="annottext">Connection -&gt; Query -&gt; IO ()
</span><span class="hs-identifier hs-var">execute_</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100271"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;CREATE TABLE IF NOT EXISTS genres (\
            \id INTEGER PRIMARY KEY AUTOINCREMENT, \
            \first_name VARCHAR(80), \
            \second_name VARCHAR(80) \
            \)&quot;</span></span><span>
</span><span id="line-62"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100271"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-comment">-- |The 'getOrCreateMovie' function ensures the unique movie title for that year exists in the database before returning it</span><span>
</span><span id="line-65"></span><span class="annot"><a href="Database.html#getOrCreateMovie"><span class="hs-identifier hs-type">getOrCreateMovie</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Types.html#Movie"><span class="hs-identifier hs-type">Movie</span></a></span><span>
</span><span id="line-66"></span><span id="getOrCreateMovie"><span class="annot"><span class="annottext">getOrCreateMovie :: Connection -&gt; String -&gt; Int -&gt; IO Movie
</span><a href="Database.html#getOrCreateMovie"><span class="hs-identifier hs-var hs-var">getOrCreateMovie</span></a></span></span><span> </span><span id="local-6989586621679100268"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100268"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span id="local-6989586621679100267"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100267"><span class="hs-identifier hs-var">tit</span></a></span></span><span> </span><span id="local-6989586621679100266"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100266"><span class="hs-identifier hs-var">year</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-67"></span><span>    </span><span id="local-6989586621679100265"><span class="annot"><span class="annottext">[Movie]
</span><a href="#local-6989586621679100265"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r.
FromRow r =&gt;
Connection -&gt; Query -&gt; [NamedParam] -&gt; IO [r]
</span><span class="hs-identifier hs-var">queryNamed</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100268"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT * FROM movies WHERE title=:title AND year=:year&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;:title&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><span class="hs-operator hs-var">:=</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100267"><span class="hs-identifier hs-var">tit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;:year&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><span class="hs-operator hs-var">:=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100266"><span class="hs-identifier hs-var">year</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Movie]
</span><a href="#local-6989586621679100265"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-69"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Movie]
</span><a href="#local-6989586621679100265"><span class="hs-identifier hs-var">results</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-71"></span><span>        </span><span class="annot"><span class="annottext">forall q. ToRow q =&gt; Connection -&gt; Query -&gt; q -&gt; IO ()
</span><span class="hs-identifier hs-var">execute</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100268"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;INSERT INTO movies (title, year) VALUES (?, ?)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100267"><span class="hs-identifier hs-var">tit</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100266"><span class="hs-identifier hs-var">year</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>        </span><span class="annot"><span class="annottext">Connection -&gt; String -&gt; Int -&gt; IO Movie
</span><a href="Database.html#getOrCreateMovie"><span class="hs-identifier hs-var">getOrCreateMovie</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100268"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100267"><span class="hs-identifier hs-var">tit</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100266"><span class="hs-identifier hs-var">year</span></a></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="annot"><a href="Database.html#getLastElement"><span class="hs-identifier hs-type">getLastElement</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-75"></span><span class="hs-comment">-- ^The 'getLastElement' connects an array of strings by spaces</span><span>
</span><span id="line-76"></span><span id="getLastElement"><span class="annot"><span class="annottext">getLastElement :: [String] -&gt; String
</span><a href="Database.html#getLastElement"><span class="hs-identifier hs-var hs-var">getLastElement</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-77"></span><span class="annot"><a href="Database.html#getLastElement"><span class="hs-identifier hs-var">getLastElement</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679100257"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100257"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621679100256"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679100256"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100257"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><a href="Database.html#getLastElement"><span class="hs-identifier hs-var">getLastElement</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679100256"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">-- |The 'getOrCreateActor' function ensures the unique actor name exists in the database before returning it</span><span>
</span><span id="line-80"></span><span class="annot"><a href="Database.html#getOrCreateActor"><span class="hs-identifier hs-type">getOrCreateActor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Types.html#Actor"><span class="hs-identifier hs-type">Actor</span></a></span><span>
</span><span id="line-81"></span><span id="getOrCreateActor"><span class="annot"><span class="annottext">getOrCreateActor :: Connection -&gt; String -&gt; IO Actor
</span><a href="Database.html#getOrCreateActor"><span class="hs-identifier hs-var hs-var">getOrCreateActor</span></a></span></span><span> </span><span id="local-6989586621679100255"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100255"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span id="local-6989586621679100254"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100254"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100253"><span class="annot"><span class="annottext">actor_name :: [String]
</span><a href="#local-6989586621679100253"><span class="hs-identifier hs-var hs-var">actor_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">words</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100254"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100251"><span class="annot"><span class="annottext">first_name :: String
</span><a href="#local-6989586621679100251"><span class="hs-identifier hs-var hs-var">first_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679100253"><span class="hs-identifier hs-var">actor_name</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100250"><span class="annot"><span class="annottext">last_name :: String
</span><a href="#local-6989586621679100250"><span class="hs-identifier hs-var hs-var">last_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><a href="Database.html#getLastElement"><span class="hs-identifier hs-var">getLastElement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679100253"><span class="hs-identifier hs-var">actor_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>    </span><span id="local-6989586621679100248"><span class="annot"><span class="annottext">[Actor]
</span><a href="#local-6989586621679100248"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r.
FromRow r =&gt;
Connection -&gt; Query -&gt; [NamedParam] -&gt; IO [r]
</span><span class="hs-identifier hs-var">queryNamed</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100255"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT * FROM actors WHERE first_name=:first_name AND last_name=:last_name&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;:first_name&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><span class="hs-operator hs-var">:=</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100251"><span class="hs-identifier hs-var">first_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;:last_name&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><span class="hs-operator hs-var">:=</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100250"><span class="hs-identifier hs-var">last_name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Actor]
</span><a href="#local-6989586621679100248"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-87"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Actor]
</span><a href="#local-6989586621679100248"><span class="hs-identifier hs-var">results</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-89"></span><span>        </span><span class="annot"><span class="annottext">forall q. ToRow q =&gt; Connection -&gt; Query -&gt; q -&gt; IO ()
</span><span class="hs-identifier hs-var">execute</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100255"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;INSERT INTO actors (first_name, last_name) VALUES (?, ?)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100251"><span class="hs-identifier hs-var">first_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100250"><span class="hs-identifier hs-var">last_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>        </span><span class="annot"><span class="annottext">Connection -&gt; String -&gt; IO Actor
</span><a href="Database.html#getOrCreateActor"><span class="hs-identifier hs-var">getOrCreateActor</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100255"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100254"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-91"></span><span>
</span><span id="line-92"></span><span class="hs-comment">-- |The 'iterateCast' function ensures every actor in a given cast is saved into the database before associating it with a movie</span><span>
</span><span id="line-93"></span><span class="annot"><a href="Database.html#iterateCast"><span class="hs-identifier hs-type">iterateCast</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#Movie"><span class="hs-identifier hs-type">Movie</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span id="iterateCast"><span class="annot"><span class="annottext">iterateCast :: Connection -&gt; Movie -&gt; [String] -&gt; IO ()
</span><a href="Database.html#iterateCast"><span class="hs-identifier hs-var hs-var">iterateCast</span></a></span></span><span> </span><span id="local-6989586621679100247"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100247"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span id="local-6989586621679100246"><span class="annot"><span class="annottext">Movie
</span><a href="#local-6989586621679100246"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679100245"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679100245"><span class="hs-identifier hs-var">cast</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-95"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679100245"><span class="hs-identifier hs-var">cast</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-97"></span><span>        </span><span id="local-6989586621679100244"><span class="annot"><span class="annottext">Actor
</span><a href="#local-6989586621679100244"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; String -&gt; IO Actor
</span><a href="Database.html#getOrCreateActor"><span class="hs-identifier hs-var">getOrCreateActor</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100247"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679100245"><span class="hs-identifier hs-var">cast</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100243"><span class="annot"><span class="annottext">mid :: Int
</span><a href="#local-6989586621679100243"><span class="hs-identifier hs-var hs-var">mid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Movie -&gt; Int
</span><a href="Types.html#movie_id_"><span class="hs-identifier hs-var">movie_id_</span></a></span><span> </span><span class="annot"><span class="annottext">Movie
</span><a href="#local-6989586621679100246"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-99"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100241"><span class="annot"><span class="annottext">aid :: Int
</span><a href="#local-6989586621679100241"><span class="hs-identifier hs-var hs-var">aid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Actor -&gt; Int
</span><a href="Types.html#actor_id_"><span class="hs-identifier hs-var">actor_id_</span></a></span><span> </span><span class="annot"><span class="annottext">Actor
</span><a href="#local-6989586621679100244"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-100"></span><span>        </span><span class="annot"><span class="annottext">forall q. ToRow q =&gt; Connection -&gt; Query -&gt; q -&gt; IO ()
</span><span class="hs-identifier hs-var">execute</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100247"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;INSERT INTO cast VALUES (?,?)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100243"><span class="hs-identifier hs-var">mid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100241"><span class="hs-identifier hs-var">aid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>        </span><span class="annot"><span class="annottext">Connection -&gt; Movie -&gt; [String] -&gt; IO ()
</span><a href="Database.html#iterateCast"><span class="hs-identifier hs-var">iterateCast</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100247"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Movie
</span><a href="#local-6989586621679100246"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679100245"><span class="hs-identifier hs-var">cast</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>
</span><span id="line-103"></span><span class="hs-comment">-- |The 'getOrCreateGenre' function ensures the unique genre exists in the database before returning it</span><span>
</span><span id="line-104"></span><span class="annot"><a href="Database.html#getOrCreateGenre"><span class="hs-identifier hs-type">getOrCreateGenre</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="Types.html#Genre"><span class="hs-identifier hs-type">Genre</span></a></span><span>
</span><span id="line-105"></span><span id="getOrCreateGenre"><span class="annot"><span class="annottext">getOrCreateGenre :: Connection -&gt; String -&gt; IO Genre
</span><a href="Database.html#getOrCreateGenre"><span class="hs-identifier hs-var hs-var">getOrCreateGenre</span></a></span></span><span> </span><span id="local-6989586621679100239"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100239"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span id="local-6989586621679100238"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100238"><span class="hs-identifier hs-var">genre</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100237"><span class="annot"><span class="annottext">genre_name :: [String]
</span><a href="#local-6989586621679100237"><span class="hs-identifier hs-var hs-var">genre_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">words</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100238"><span class="hs-identifier hs-var">genre</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100236"><span class="annot"><span class="annottext">first_name :: String
</span><a href="#local-6989586621679100236"><span class="hs-identifier hs-var hs-var">first_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679100237"><span class="hs-identifier hs-var">genre_name</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100235"><span class="annot"><span class="annottext">second_name :: String
</span><a href="#local-6989586621679100235"><span class="hs-identifier hs-var hs-var">second_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><a href="Database.html#getLastElement"><span class="hs-identifier hs-var">getLastElement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679100237"><span class="hs-identifier hs-var">genre_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>    </span><span id="local-6989586621679100234"><span class="annot"><span class="annottext">[Genre]
</span><a href="#local-6989586621679100234"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall r.
FromRow r =&gt;
Connection -&gt; Query -&gt; [NamedParam] -&gt; IO [r]
</span><span class="hs-identifier hs-var">queryNamed</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100239"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT * FROM genres WHERE first_name=:first_name AND second_name=:second_name&quot;</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;:first_name&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><span class="hs-operator hs-var">:=</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100236"><span class="hs-identifier hs-var">first_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;:second_name&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall v. ToField v =&gt; Text -&gt; v -&gt; NamedParam
</span><span class="hs-operator hs-var">:=</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100235"><span class="hs-identifier hs-var">second_name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-110"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Genre]
</span><a href="#local-6989586621679100234"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Genre]
</span><a href="#local-6989586621679100234"><span class="hs-identifier hs-var">results</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-113"></span><span>        </span><span class="annot"><span class="annottext">forall q. ToRow q =&gt; Connection -&gt; Query -&gt; q -&gt; IO ()
</span><span class="hs-identifier hs-var">execute</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100239"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;INSERT INTO genres (first_name, second_name) VALUES (?, ?)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100236"><span class="hs-identifier hs-var">first_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100235"><span class="hs-identifier hs-var">second_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><span class="annottext">Connection -&gt; String -&gt; IO Genre
</span><a href="Database.html#getOrCreateGenre"><span class="hs-identifier hs-var">getOrCreateGenre</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100239"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100238"><span class="hs-identifier hs-var">genre</span></a></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-comment">-- |The 'iterateGenre' function ensures every genres in a given list is saved into the database before associating it with a movie</span><span>
</span><span id="line-117"></span><span class="annot"><a href="Database.html#iterateGenre"><span class="hs-identifier hs-type">iterateGenre</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#Movie"><span class="hs-identifier hs-type">Movie</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span id="iterateGenre"><span class="annot"><span class="annottext">iterateGenre :: Connection -&gt; Movie -&gt; [String] -&gt; IO ()
</span><a href="Database.html#iterateGenre"><span class="hs-identifier hs-var hs-var">iterateGenre</span></a></span></span><span> </span><span id="local-6989586621679100233"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100233"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span id="local-6989586621679100232"><span class="annot"><span class="annottext">Movie
</span><a href="#local-6989586621679100232"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621679100231"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679100231"><span class="hs-identifier hs-var">genres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679100231"><span class="hs-identifier hs-var">genres</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-121"></span><span>        </span><span id="local-6989586621679100230"><span class="annot"><span class="annottext">Genre
</span><a href="#local-6989586621679100230"><span class="hs-identifier hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; String -&gt; IO Genre
</span><a href="Database.html#getOrCreateGenre"><span class="hs-identifier hs-var">getOrCreateGenre</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100233"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679100231"><span class="hs-identifier hs-var">genres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-122"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100229"><span class="annot"><span class="annottext">mid :: Int
</span><a href="#local-6989586621679100229"><span class="hs-identifier hs-var hs-var">mid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Movie -&gt; Int
</span><a href="Types.html#movie_id_"><span class="hs-identifier hs-var">movie_id_</span></a></span><span> </span><span class="annot"><span class="annottext">Movie
</span><a href="#local-6989586621679100232"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-123"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100228"><span class="annot"><span class="annottext">gid :: Int
</span><a href="#local-6989586621679100228"><span class="hs-identifier hs-var hs-var">gid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Genre -&gt; Int
</span><a href="Types.html#genre_id_"><span class="hs-identifier hs-var">genre_id_</span></a></span><span> </span><span class="annot"><span class="annottext">Genre
</span><a href="#local-6989586621679100230"><span class="hs-identifier hs-var">g</span></a></span><span>
</span><span id="line-124"></span><span>        </span><span class="annot"><span class="annottext">forall q. ToRow q =&gt; Connection -&gt; Query -&gt; q -&gt; IO ()
</span><span class="hs-identifier hs-var">execute</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100233"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;INSERT INTO movie_genre VALUES (?,?)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100229"><span class="hs-identifier hs-var">mid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100228"><span class="hs-identifier hs-var">gid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>        </span><span class="annot"><span class="annottext">Connection -&gt; Movie -&gt; [String] -&gt; IO ()
</span><a href="Database.html#iterateGenre"><span class="hs-identifier hs-var">iterateGenre</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100233"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Movie
</span><a href="#local-6989586621679100232"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621679100231"><span class="hs-identifier hs-var">genres</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>
</span><span id="line-127"></span><span class="hs-comment">-- |The 'createRecord' function saves the full record of a given movie into the database</span><span>
</span><span id="line-128"></span><span class="annot"><a href="Database.html#createRecord"><span class="hs-identifier hs-type">createRecord</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Types.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span id="createRecord"><span class="annot"><span class="annottext">createRecord :: Connection -&gt; Record -&gt; IO ()
</span><a href="Database.html#createRecord"><span class="hs-identifier hs-var hs-var">createRecord</span></a></span></span><span> </span><span id="local-6989586621679100226"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100226"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span id="local-6989586621679100225"><span class="annot"><span class="annottext">Record
</span><a href="#local-6989586621679100225"><span class="hs-identifier hs-var">record</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-130"></span><span>    </span><span id="local-6989586621679100224"><span class="annot"><span class="annottext">Movie
</span><a href="#local-6989586621679100224"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; String -&gt; Int -&gt; IO Movie
</span><a href="Database.html#getOrCreateMovie"><span class="hs-identifier hs-var">getOrCreateMovie</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100226"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Record -&gt; String
</span><a href="Types.html#title"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">Record
</span><a href="#local-6989586621679100225"><span class="hs-identifier hs-var">record</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Record -&gt; Int
</span><a href="Types.html#year"><span class="hs-identifier hs-var">year</span></a></span><span> </span><span class="annot"><span class="annottext">Record
</span><a href="#local-6989586621679100225"><span class="hs-identifier hs-var">record</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Movie -&gt; [String] -&gt; IO ()
</span><a href="Database.html#iterateCast"><span class="hs-identifier hs-var">iterateCast</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100226"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Movie
</span><a href="#local-6989586621679100224"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Record -&gt; [String]
</span><a href="Types.html#cast"><span class="hs-identifier hs-var">cast</span></a></span><span> </span><span class="annot"><span class="annottext">Record
</span><a href="#local-6989586621679100225"><span class="hs-identifier hs-var">record</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><span class="annottext">Connection -&gt; Movie -&gt; [String] -&gt; IO ()
</span><a href="Database.html#iterateGenre"><span class="hs-identifier hs-var">iterateGenre</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100226"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Movie
</span><a href="#local-6989586621679100224"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Record -&gt; [String]
</span><a href="Types.html#genres"><span class="hs-identifier hs-var">genres</span></a></span><span> </span><span class="annot"><span class="annottext">Record
</span><a href="#local-6989586621679100225"><span class="hs-identifier hs-var">record</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>    </span><span>
</span><span id="line-134"></span><span class="hs-comment">-- |The 'saveRecords' function saves the full record of all movies in a list of movies into the database</span><span>
</span><span id="line-135"></span><span class="annot"><a href="Database.html#saveRecords"><span class="hs-identifier hs-type">saveRecords</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#Record"><span class="hs-identifier hs-type">Record</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span id="saveRecords"><span class="annot"><span class="annottext">saveRecords :: Connection -&gt; [Record] -&gt; IO ()
</span><a href="Database.html#saveRecords"><span class="hs-identifier hs-var hs-var">saveRecords</span></a></span></span><span> </span><span id="local-6989586621679100219"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100219"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><span class="hs-identifier hs-var">mapM_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Connection -&gt; Record -&gt; IO ()
</span><a href="Database.html#createRecord"><span class="hs-identifier hs-var">createRecord</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100219"><span class="hs-identifier hs-var">conn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-comment">-- |The 'databaseQueries' function opens the menu for the user to perform queries on the database</span><span>
</span><span id="line-139"></span><span class="annot"><a href="Database.html#databaseQueries"><span class="hs-identifier hs-type">databaseQueries</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span id="databaseQueries"><span class="annot"><span class="annottext">databaseQueries :: Connection -&gt; IO ()
</span><a href="Database.html#databaseQueries"><span class="hs-identifier hs-var hs-var">databaseQueries</span></a></span></span><span> </span><span id="local-6989586621679100217"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100217"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;=============================&quot;</span></span><span>
</span><span id="line-142"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    DATABASE QUERY OPTIONS&quot;</span></span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;=============================&quot;</span></span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; 1. Get full details of any movie&quot;</span></span><span>
</span><span id="line-145"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; 2. Get full details of any actor&quot;</span></span><span>
</span><span id="line-146"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; 3. Get full details of any genre&quot;</span></span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; 4. Get movies released in any year&quot;</span></span><span>
</span><span id="line-148"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; 5. Back&quot;</span></span><span>
</span><span id="line-149"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;=============================&quot;</span></span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-151"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Please choose an option: &quot;</span></span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621679100215"><span class="annot"><span class="annottext">Either SomeException Int
</span><a href="#local-6989586621679100215"><span class="hs-identifier hs-var">queryChoice</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="annot"><span class="annottext">forall a. Read a =&gt; IO a
</span><span class="hs-identifier hs-var">readLn</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either SomeException Int
</span><a href="#local-6989586621679100215"><span class="hs-identifier hs-var">queryChoice</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-154"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679100212"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679100212"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-155"></span><span>            </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">print</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Invalid option&quot;</span></span><span>
</span><span id="line-156"></span><span>            </span><span class="annot"><span class="annottext">Connection -&gt; IO ()
</span><a href="Database.html#databaseQueries"><span class="hs-identifier hs-var">databaseQueries</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100217"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-157"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679100211"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100211"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-158"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100211"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-159"></span><span>                </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-160"></span><span>                    </span><span id="local-6989586621679100210"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100210"><span class="hs-identifier hs-var">movieDetails</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO String
</span><a href="Database.html#queryMovie"><span class="hs-identifier hs-var">queryMovie</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100217"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-161"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;=============================&quot;</span></span><span>
</span><span id="line-162"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStr</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100210"><span class="hs-identifier hs-var">movieDetails</span></a></span><span>
</span><span id="line-163"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;=============================&quot;</span></span><span>
</span><span id="line-164"></span><span>                    </span><span class="annot"><span class="annottext">Connection -&gt; IO ()
</span><a href="Database.html#databaseQueries"><span class="hs-identifier hs-var">databaseQueries</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100217"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-165"></span><span>                </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-166"></span><span>                    </span><span id="local-6989586621679100208"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100208"><span class="hs-identifier hs-var">actorDetails</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO String
</span><a href="Database.html#queryActor"><span class="hs-identifier hs-var">queryActor</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100217"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-167"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;=============================&quot;</span></span><span>
</span><span id="line-168"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100208"><span class="hs-identifier hs-var">actorDetails</span></a></span><span>
</span><span id="line-169"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;=============================&quot;</span></span><span>
</span><span id="line-170"></span><span>                    </span><span class="annot"><span class="annottext">Connection -&gt; IO ()
</span><a href="Database.html#databaseQueries"><span class="hs-identifier hs-var">databaseQueries</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100217"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-171"></span><span>                </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-172"></span><span>                    </span><span id="local-6989586621679100207"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100207"><span class="hs-identifier hs-var">genreDetails</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO String
</span><a href="Database.html#queryGenre"><span class="hs-identifier hs-var">queryGenre</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100217"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-173"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;=============================&quot;</span></span><span>
</span><span id="line-174"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100207"><span class="hs-identifier hs-var">genreDetails</span></a></span><span>
</span><span id="line-175"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;=============================&quot;</span></span><span>
</span><span id="line-176"></span><span>                    </span><span class="annot"><span class="annottext">Connection -&gt; IO ()
</span><a href="Database.html#databaseQueries"><span class="hs-identifier hs-var">databaseQueries</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100217"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-177"></span><span>                </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>                    </span><span id="local-6989586621679100206"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100206"><span class="hs-identifier hs-var">yearDetails</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Connection -&gt; IO String
</span><a href="Database.html#queryYear"><span class="hs-identifier hs-var">queryYear</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100217"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-179"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;=============================&quot;</span></span><span>
</span><span id="line-180"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100206"><span class="hs-identifier hs-var">yearDetails</span></a></span><span>
</span><span id="line-181"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStrLn</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;=============================&quot;</span></span><span>
</span><span id="line-182"></span><span>                    </span><span class="annot"><span class="annottext">Connection -&gt; IO ()
</span><a href="Database.html#databaseQueries"><span class="hs-identifier hs-var">databaseQueries</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100217"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-183"></span><span>                </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">print</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;We hope you enjoyed querying!&quot;</span></span><span>
</span><span id="line-184"></span><span>                </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-185"></span><span>                    </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">print</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Invalid option&quot;</span></span><span>
</span><span id="line-186"></span><span>                    </span><span class="annot"><span class="annottext">Connection -&gt; IO ()
</span><a href="Database.html#databaseQueries"><span class="hs-identifier hs-var">databaseQueries</span></a></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100217"><span class="hs-identifier hs-var">conn</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-comment">-- |The 'extractActorResults' transforms an array of Actor's into a displayable string with the names of all the actors in the array</span><span>
</span><span id="line-189"></span><span class="annot"><a href="Database.html#extractActorResults"><span class="hs-identifier hs-type">extractActorResults</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#Actor"><span class="hs-identifier hs-type">Actor</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-190"></span><span id="extractActorResults"><span class="annot"><span class="annottext">extractActorResults :: [Actor] -&gt; String
</span><a href="Database.html#extractActorResults"><span class="hs-identifier hs-var hs-var">extractActorResults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679100204"><span class="annot"><span class="annottext">Actor
</span><a href="#local-6989586621679100204"><span class="hs-identifier hs-var">actorRec</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">(++)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Actor -&gt; String
</span><a href="Types.html#actor_first_name_"><span class="hs-identifier hs-var">actor_first_name_</span></a></span><span> </span><span class="annot"><span class="annottext">Actor
</span><a href="#local-6989586621679100204"><span class="hs-identifier hs-var">actorRec</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Actor -&gt; String
</span><a href="Types.html#actor_last_name_"><span class="hs-identifier hs-var">actor_last_name_</span></a></span><span> </span><span class="annot"><span class="annottext">Actor
</span><a href="#local-6989586621679100204"><span class="hs-identifier hs-var">actorRec</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-comment">-- |The 'extractGenreResults' transforms an array of Genre's into a displayable string with the names of all the genres in the array</span><span>
</span><span id="line-193"></span><span class="annot"><a href="Database.html#extractGenreResults"><span class="hs-identifier hs-type">extractGenreResults</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#Genre"><span class="hs-identifier hs-type">Genre</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-194"></span><span id="extractGenreResults"><span class="annot"><span class="annottext">extractGenreResults :: [Genre] -&gt; String
</span><a href="Database.html#extractGenreResults"><span class="hs-identifier hs-var hs-var">extractGenreResults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldr</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621679100201"><span class="annot"><span class="annottext">Genre
</span><a href="#local-6989586621679100201"><span class="hs-identifier hs-var">genreRec</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">(++)</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Genre -&gt; String
</span><a href="Types.html#genre_first_name_"><span class="hs-identifier hs-var">genre_first_name_</span></a></span><span> </span><span class="annot"><span class="annottext">Genre
</span><a href="#local-6989586621679100201"><span class="hs-identifier hs-var">genreRec</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">Genre -&gt; String
</span><a href="Types.html#genre_second_name_"><span class="hs-identifier hs-var">genre_second_name_</span></a></span><span> </span><span class="annot"><span class="annottext">Genre
</span><a href="#local-6989586621679100201"><span class="hs-identifier hs-var">genreRec</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-comment">-- |The 'queryMovie' allows the user to see details of a movie with a specific title</span><span>
</span><span id="line-197"></span><span class="annot"><a href="Database.html#queryMovie"><span class="hs-identifier hs-type">queryMovie</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-198"></span><span id="queryMovie"><span class="annot"><span class="annottext">queryMovie :: Connection -&gt; IO String
</span><a href="Database.html#queryMovie"><span class="hs-identifier hs-var hs-var">queryMovie</span></a></span></span><span> </span><span id="local-6989586621679100198"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100198"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStr</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Enter movie title &gt; &quot;</span></span><span>
</span><span id="line-200"></span><span>    </span><span id="local-6989586621679100197"><span class="annot"><span class="annottext">Either SomeException String
</span><a href="#local-6989586621679100197"><span class="hs-identifier hs-var">userInput</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getLine</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either SomeException String
</span><a href="#local-6989586621679100197"><span class="hs-identifier hs-var">userInput</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-202"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679100195"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679100195"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-203"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Invalid input&quot;</span></span><span>
</span><span id="line-204"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679100194"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100194"><span class="hs-identifier hs-var">movieName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-205"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100192"><span class="annot"><span class="annottext">sql1 :: Query
</span><a href="#local-6989586621679100192"><span class="hs-identifier hs-var hs-var">sql1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT DISTINCT * FROM movies m WHERE m.title = ?&quot;</span></span><span>
</span><span id="line-206"></span><span>            </span><span id="local-6989586621679100191"><span class="annot"><span class="annottext">[Movie]
</span><a href="#local-6989586621679100191"><span class="hs-identifier hs-var">movieResults</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall q r.
(ToRow q, FromRow r) =&gt;
Connection -&gt; Query -&gt; q -&gt; IO [r]
</span><span class="hs-identifier hs-var">query</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100198"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679100192"><span class="hs-identifier hs-var">sql1</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100194"><span class="hs-identifier hs-var">movieName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-207"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Movie]
</span><a href="#local-6989586621679100191"><span class="hs-identifier hs-var">movieResults</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-208"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100188"><span class="annot"><span class="annottext">sql2 :: Query
</span><a href="#local-6989586621679100188"><span class="hs-identifier hs-var hs-var">sql2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT DISTINCT a.* FROM actors a JOIN cast c ON a.id == c.fk_movie_actor JOIN movies m ON c.fk_movie_cast == m.id WHERE m.title = ?&quot;</span></span><span>
</span><span id="line-209"></span><span>                </span><span id="local-6989586621679100187"><span class="annot"><span class="annottext">[Actor]
</span><a href="#local-6989586621679100187"><span class="hs-identifier hs-var">actorResults</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall q r.
(ToRow q, FromRow r) =&gt;
Connection -&gt; Query -&gt; q -&gt; IO [r]
</span><span class="hs-identifier hs-var">query</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100198"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679100188"><span class="hs-identifier hs-var">sql2</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100194"><span class="hs-identifier hs-var">movieName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-210"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100185"><span class="annot"><span class="annottext">sql3 :: Query
</span><a href="#local-6989586621679100185"><span class="hs-identifier hs-var hs-var">sql3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT DISTINCT g.* FROM genres g JOIN movie_genre mg ON g.id == mg.fk_genre_genre JOIN movies m ON mg.fk_movie_genre == m.id WHERE m.title = ?&quot;</span></span><span>
</span><span id="line-211"></span><span>                </span><span id="local-6989586621679100184"><span class="annot"><span class="annottext">[Genre]
</span><a href="#local-6989586621679100184"><span class="hs-identifier hs-var">genreResults</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall q r.
(ToRow q, FromRow r) =&gt;
Connection -&gt; Query -&gt; q -&gt; IO [r]
</span><span class="hs-identifier hs-var">query</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100198"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679100185"><span class="hs-identifier hs-var">sql3</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100194"><span class="hs-identifier hs-var">movieName</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-212"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100183"><span class="annot"><span class="annottext">movieTitle :: String
</span><a href="#local-6989586621679100183"><span class="hs-identifier hs-var hs-var">movieTitle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Movie -&gt; String
</span><a href="Types.html#title_"><span class="hs-identifier hs-var">title_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Movie]
</span><a href="#local-6989586621679100191"><span class="hs-identifier hs-var">movieResults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100181"><span class="annot"><span class="annottext">movieYear :: Int
</span><a href="#local-6989586621679100181"><span class="hs-identifier hs-var hs-var">movieYear</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Movie -&gt; Int
</span><a href="Types.html#year_"><span class="hs-identifier hs-var">year_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Movie]
</span><a href="#local-6989586621679100191"><span class="hs-identifier hs-var">movieResults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-214"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100179"><span class="annot"><span class="annottext">movieCast :: String
</span><a href="#local-6989586621679100179"><span class="hs-identifier hs-var hs-var">movieCast</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Actor] -&gt; String
</span><a href="Database.html#extractActorResults"><span class="hs-identifier hs-var">extractActorResults</span></a></span><span> </span><span class="annot"><span class="annottext">[Actor]
</span><a href="#local-6989586621679100187"><span class="hs-identifier hs-var">actorResults</span></a></span><span>
</span><span id="line-215"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100178"><span class="annot"><span class="annottext">movieGenres :: String
</span><a href="#local-6989586621679100178"><span class="hs-identifier hs-var hs-var">movieGenres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Genre] -&gt; String
</span><a href="Database.html#extractGenreResults"><span class="hs-identifier hs-var">extractGenreResults</span></a></span><span> </span><span class="annot"><span class="annottext">[Genre]
</span><a href="#local-6989586621679100184"><span class="hs-identifier hs-var">genreResults</span></a></span><span>
</span><span id="line-216"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Title: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100183"><span class="hs-identifier hs-var">movieTitle</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nYear Released: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100181"><span class="hs-identifier hs-var">movieYear</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nCast: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100179"><span class="hs-identifier hs-var">movieCast</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nGenres: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100178"><span class="hs-identifier hs-var">movieGenres</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Error: this movie isn't in our database.\n&quot;</span></span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span class="hs-comment">-- |The 'queryActor' allows the user to see details of an actor with a specific name</span><span>
</span><span id="line-220"></span><span class="annot"><a href="Database.html#queryActor"><span class="hs-identifier hs-type">queryActor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-221"></span><span id="queryActor"><span class="annot"><span class="annottext">queryActor :: Connection -&gt; IO String
</span><a href="Database.html#queryActor"><span class="hs-identifier hs-var hs-var">queryActor</span></a></span></span><span> </span><span id="local-6989586621679100176"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100176"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-222"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStr</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Enter actor name &gt; &quot;</span></span><span>
</span><span id="line-223"></span><span>    </span><span id="local-6989586621679100175"><span class="annot"><span class="annottext">Either SomeException String
</span><a href="#local-6989586621679100175"><span class="hs-identifier hs-var">userInput</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getLine</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either SomeException String
</span><a href="#local-6989586621679100175"><span class="hs-identifier hs-var">userInput</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-225"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679100174"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679100174"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-226"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Invalid input&quot;</span></span><span>
</span><span id="line-227"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679100173"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100173"><span class="hs-identifier hs-var">actorName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-228"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100172"><span class="annot"><span class="annottext">actor_fn :: String
</span><a href="#local-6989586621679100172"><span class="hs-identifier hs-var hs-var">actor_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">words</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100173"><span class="hs-identifier hs-var">actorName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100171"><span class="annot"><span class="annottext">actor_ln :: String
</span><a href="#local-6989586621679100171"><span class="hs-identifier hs-var hs-var">actor_ln</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><a href="Database.html#getLastElement"><span class="hs-identifier hs-var">getLastElement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">words</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100173"><span class="hs-identifier hs-var">actorName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100169"><span class="annot"><span class="annottext">sql1 :: Query
</span><a href="#local-6989586621679100169"><span class="hs-identifier hs-var hs-var">sql1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT DISTINCT a.* FROM actors a WHERE a.first_name = ? AND a.last_name = ?&quot;</span></span><span>
</span><span id="line-231"></span><span>            </span><span id="local-6989586621679100168"><span class="annot"><span class="annottext">[Actor]
</span><a href="#local-6989586621679100168"><span class="hs-identifier hs-var">actorResults</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall q r.
(ToRow q, FromRow r) =&gt;
Connection -&gt; Query -&gt; q -&gt; IO [r]
</span><span class="hs-identifier hs-var">query</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100176"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679100169"><span class="hs-identifier hs-var">sql1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100172"><span class="hs-identifier hs-var">actor_fn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100171"><span class="hs-identifier hs-var">actor_ln</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#Actor"><span class="hs-identifier hs-type">Actor</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-232"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Actor]
</span><a href="#local-6989586621679100168"><span class="hs-identifier hs-var">actorResults</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-233"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100166"><span class="annot"><span class="annottext">sql2 :: Query
</span><a href="#local-6989586621679100166"><span class="hs-identifier hs-var hs-var">sql2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT DISTINCT m.* FROM movies m JOIN cast c ON m.id == c.fk_movie_cast JOIN actors a ON c.fk_movie_actor == a.id WHERE a.first_name = ? AND a.last_name = ? ORDER BY m.year DESC&quot;</span></span><span>
</span><span id="line-234"></span><span>                </span><span id="local-6989586621679100165"><span class="annot"><span class="annottext">[Movie]
</span><a href="#local-6989586621679100165"><span class="hs-identifier hs-var">movieResults</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall q r.
(ToRow q, FromRow r) =&gt;
Connection -&gt; Query -&gt; q -&gt; IO [r]
</span><span class="hs-identifier hs-var">query</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100176"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679100166"><span class="hs-identifier hs-var">sql2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100172"><span class="hs-identifier hs-var">actor_fn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100171"><span class="hs-identifier hs-var">actor_ln</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#Movie"><span class="hs-identifier hs-type">Movie</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-235"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100163"><span class="annot"><span class="annottext">sql3 :: Query
</span><a href="#local-6989586621679100163"><span class="hs-identifier hs-var hs-var">sql3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT DISTINCT g.* FROM genres g JOIN movie_genre mg ON g.id == mg.fk_genre_genre JOIN movies m ON mg.fk_movie_genre == m.id JOIN cast c ON m.id == c.fk_movie_cast JOIN actors a ON c.fk_movie_actor == a.id WHERE a.first_name = ? AND a.last_name = ?&quot;</span></span><span>
</span><span id="line-236"></span><span>                </span><span id="local-6989586621679100162"><span class="annot"><span class="annottext">[Genre]
</span><a href="#local-6989586621679100162"><span class="hs-identifier hs-var">genreResults</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall q r.
(ToRow q, FromRow r) =&gt;
Connection -&gt; Query -&gt; q -&gt; IO [r]
</span><span class="hs-identifier hs-var">query</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100176"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679100163"><span class="hs-identifier hs-var">sql3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100172"><span class="hs-identifier hs-var">actor_fn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100171"><span class="hs-identifier hs-var">actor_ln</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#Genre"><span class="hs-identifier hs-type">Genre</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-237"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100161"><span class="annot"><span class="annottext">a_fn :: String
</span><a href="#local-6989586621679100161"><span class="hs-identifier hs-var hs-var">a_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Actor -&gt; String
</span><a href="Types.html#actor_first_name_"><span class="hs-identifier hs-var">actor_first_name_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Actor]
</span><a href="#local-6989586621679100168"><span class="hs-identifier hs-var">actorResults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100160"><span class="annot"><span class="annottext">a_ln :: String
</span><a href="#local-6989586621679100160"><span class="hs-identifier hs-var hs-var">a_ln</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Actor -&gt; String
</span><a href="Types.html#actor_last_name_"><span class="hs-identifier hs-var">actor_last_name_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Actor]
</span><a href="#local-6989586621679100168"><span class="hs-identifier hs-var">actorResults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100158"><span class="annot"><span class="annottext">num_genres :: Int
</span><a href="#local-6989586621679100158"><span class="hs-identifier hs-var hs-var">num_genres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Genre]
</span><a href="#local-6989586621679100162"><span class="hs-identifier hs-var">genreResults</span></a></span><span>
</span><span id="line-240"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100155"><span class="annot"><span class="annottext">num_movies :: Int
</span><a href="#local-6989586621679100155"><span class="hs-identifier hs-var hs-var">num_movies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Movie]
</span><a href="#local-6989586621679100165"><span class="hs-identifier hs-var">movieResults</span></a></span><span>
</span><span id="line-241"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100146"><span class="annot"><span class="annottext">output :: String
</span><a href="#local-6989586621679100146"><span class="hs-identifier hs-var hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Name: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100161"><span class="hs-identifier hs-var">a_fn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100160"><span class="hs-identifier hs-var">a_ln</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nNo. of movies: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100155"><span class="hs-identifier hs-var">num_movies</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nNo. of genres: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100158"><span class="hs-identifier hs-var">num_genres</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nLatest movie: &quot;</span></span><span>
</span><span id="line-242"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100155"><span class="hs-identifier hs-var">num_movies</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-243"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100144"><span class="annot"><span class="annottext">latest_movie :: String
</span><a href="#local-6989586621679100144"><span class="hs-identifier hs-var hs-var">latest_movie</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Movie -&gt; String
</span><a href="Types.html#title_"><span class="hs-identifier hs-var">title_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Movie]
</span><a href="#local-6989586621679100165"><span class="hs-identifier hs-var">movieResults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>                    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100146"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100144"><span class="hs-identifier hs-var">latest_movie</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span>
</span><span id="line-246"></span><span>                    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100146"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;None&quot;</span></span><span class="hs-special">)</span><span>            </span><span>
</span><span id="line-247"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Error: this actor isn't in our database.&quot;</span></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span class="hs-comment">-- |The 'queryGenre' allows the user to see details of an genre with a specific name</span><span>
</span><span id="line-250"></span><span class="annot"><a href="Database.html#queryGenre"><span class="hs-identifier hs-type">queryGenre</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-251"></span><span id="queryGenre"><span class="annot"><span class="annottext">queryGenre :: Connection -&gt; IO String
</span><a href="Database.html#queryGenre"><span class="hs-identifier hs-var hs-var">queryGenre</span></a></span></span><span> </span><span id="local-6989586621679100143"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100143"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-252"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStr</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Enter genre name &gt; &quot;</span></span><span>
</span><span id="line-253"></span><span>    </span><span id="local-6989586621679100142"><span class="annot"><span class="annottext">Either SomeException String
</span><a href="#local-6989586621679100142"><span class="hs-identifier hs-var">userInput</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="annot"><span class="annottext">IO String
</span><span class="hs-identifier hs-var">getLine</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either SomeException String
</span><a href="#local-6989586621679100142"><span class="hs-identifier hs-var">userInput</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-255"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679100141"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679100141"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-256"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Invalid input&quot;</span></span><span>
</span><span id="line-257"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679100140"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100140"><span class="hs-identifier hs-var">genreName</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-258"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100139"><span class="annot"><span class="annottext">genre_fn :: String
</span><a href="#local-6989586621679100139"><span class="hs-identifier hs-var hs-var">genre_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">words</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100140"><span class="hs-identifier hs-var">genreName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100138"><span class="annot"><span class="annottext">genre_sn :: String
</span><a href="#local-6989586621679100138"><span class="hs-identifier hs-var hs-var">genre_sn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><a href="Database.html#getLastElement"><span class="hs-identifier hs-var">getLastElement</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String]
</span><span class="hs-identifier hs-var">words</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100140"><span class="hs-identifier hs-var">genreName</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-260"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100136"><span class="annot"><span class="annottext">sql1 :: Query
</span><a href="#local-6989586621679100136"><span class="hs-identifier hs-var hs-var">sql1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT DISTINCT g.* FROM genres g WHERE g.first_name = ? AND g.second_name = ?&quot;</span></span><span>
</span><span id="line-261"></span><span>            </span><span id="local-6989586621679100135"><span class="annot"><span class="annottext">[Genre]
</span><a href="#local-6989586621679100135"><span class="hs-identifier hs-var">genreResults</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall q r.
(ToRow q, FromRow r) =&gt;
Connection -&gt; Query -&gt; q -&gt; IO [r]
</span><span class="hs-identifier hs-var">query</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100143"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679100136"><span class="hs-identifier hs-var">sql1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100139"><span class="hs-identifier hs-var">genre_fn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100138"><span class="hs-identifier hs-var">genre_sn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#Genre"><span class="hs-identifier hs-type">Genre</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-262"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Genre]
</span><a href="#local-6989586621679100135"><span class="hs-identifier hs-var">genreResults</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-263"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100133"><span class="annot"><span class="annottext">sql2 :: Query
</span><a href="#local-6989586621679100133"><span class="hs-identifier hs-var hs-var">sql2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT DISTINCT m.* FROM movies m JOIN movie_genre mg ON m.id == mg.fk_movie_genre JOIN genres g ON mg.fk_genre_genre == g.id WHERE g.first_name = ? AND g.second_name = ? ORDER BY m.year DESC&quot;</span></span><span>
</span><span id="line-264"></span><span>                </span><span id="local-6989586621679100132"><span class="annot"><span class="annottext">[Movie]
</span><a href="#local-6989586621679100132"><span class="hs-identifier hs-var">movieResults</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall q r.
(ToRow q, FromRow r) =&gt;
Connection -&gt; Query -&gt; q -&gt; IO [r]
</span><span class="hs-identifier hs-var">query</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100143"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679100133"><span class="hs-identifier hs-var">sql2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100139"><span class="hs-identifier hs-var">genre_fn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100138"><span class="hs-identifier hs-var">genre_sn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#Movie"><span class="hs-identifier hs-type">Movie</span></a></span><span class="hs-special">]</span><span> </span><span>
</span><span id="line-265"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100131"><span class="annot"><span class="annottext">g_fn :: String
</span><a href="#local-6989586621679100131"><span class="hs-identifier hs-var hs-var">g_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Genre -&gt; String
</span><a href="Types.html#genre_first_name_"><span class="hs-identifier hs-var">genre_first_name_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Genre]
</span><a href="#local-6989586621679100135"><span class="hs-identifier hs-var">genreResults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-266"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100130"><span class="annot"><span class="annottext">g_sn :: String
</span><a href="#local-6989586621679100130"><span class="hs-identifier hs-var hs-var">g_sn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Genre -&gt; String
</span><a href="Types.html#genre_second_name_"><span class="hs-identifier hs-var">genre_second_name_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Genre]
</span><a href="#local-6989586621679100135"><span class="hs-identifier hs-var">genreResults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100128"><span class="annot"><span class="annottext">num_movies :: Int
</span><a href="#local-6989586621679100128"><span class="hs-identifier hs-var hs-var">num_movies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Movie]
</span><a href="#local-6989586621679100132"><span class="hs-identifier hs-var">movieResults</span></a></span><span>
</span><span id="line-268"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100121"><span class="annot"><span class="annottext">output :: String
</span><a href="#local-6989586621679100121"><span class="hs-identifier hs-var hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Name: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100131"><span class="hs-identifier hs-var">g_fn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100130"><span class="hs-identifier hs-var">g_sn</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nNo. of movies: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100128"><span class="hs-identifier hs-var">num_movies</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nLatest movie: &quot;</span></span><span>
</span><span id="line-269"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100128"><span class="hs-identifier hs-var">num_movies</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-270"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100120"><span class="annot"><span class="annottext">latest_movie :: String
</span><a href="#local-6989586621679100120"><span class="hs-identifier hs-var hs-var">latest_movie</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Movie -&gt; String
</span><a href="Types.html#title_"><span class="hs-identifier hs-var">title_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Movie]
</span><a href="#local-6989586621679100132"><span class="hs-identifier hs-var">movieResults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>                    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100121"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100120"><span class="hs-identifier hs-var">latest_movie</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span>
</span><span id="line-273"></span><span>                    </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100121"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;None&quot;</span></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-274"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Error: this genre isn't in our database.&quot;</span></span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-comment">-- |The 'queryYear' allows the user to see details of a specfic year</span><span>
</span><span id="line-277"></span><span class="annot"><a href="Database.html#queryYear"><span class="hs-identifier hs-type">queryYear</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Connection</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span>
</span><span id="line-278"></span><span id="queryYear"><span class="annot"><span class="annottext">queryYear :: Connection -&gt; IO String
</span><a href="Database.html#queryYear"><span class="hs-identifier hs-var hs-var">queryYear</span></a></span></span><span> </span><span id="local-6989586621679100119"><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100119"><span class="hs-identifier hs-var">conn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-279"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><span class="hs-identifier hs-var">putStr</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Enter year &gt; &quot;</span></span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621679100118"><span class="annot"><span class="annottext">Either SomeException Int
</span><a href="#local-6989586621679100118"><span class="hs-identifier hs-var">userInput</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall e a. Exception e =&gt; IO a -&gt; IO (Either e a)
</span><span class="hs-identifier hs-var">try</span></span><span> </span><span class="annot"><span class="annottext">forall a. Read a =&gt; IO a
</span><span class="hs-identifier hs-var">readLn</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either SomeException Int
</span><a href="#local-6989586621679100118"><span class="hs-identifier hs-var">userInput</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-282"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679100117"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679100117"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-283"></span><span>            </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Invalid input&quot;</span></span><span>
</span><span id="line-284"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679100116"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100116"><span class="hs-identifier hs-var">year</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-285"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100114"><span class="annot"><span class="annottext">sql :: Query
</span><a href="#local-6989586621679100114"><span class="hs-identifier hs-var hs-var">sql</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Query
</span><span class="hs-string">&quot;SELECT DISTINCT m.* FROM movies m WHERE m.year = ?&quot;</span></span><span> </span><span>
</span><span id="line-286"></span><span>            </span><span id="local-6989586621679100113"><span class="annot"><span class="annottext">[Movie]
</span><a href="#local-6989586621679100113"><span class="hs-identifier hs-var">movieResults</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall q r.
(ToRow q, FromRow r) =&gt;
Connection -&gt; Query -&gt; q -&gt; IO [r]
</span><span class="hs-identifier hs-var">query</span></span><span> </span><span class="annot"><span class="annottext">Connection
</span><a href="#local-6989586621679100119"><span class="hs-identifier hs-var">conn</span></a></span><span> </span><span class="annot"><span class="annottext">Query
</span><a href="#local-6989586621679100114"><span class="hs-identifier hs-var">sql</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100116"><span class="hs-identifier hs-var">year</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Types.html#Movie"><span class="hs-identifier hs-type">Movie</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-287"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">[Movie]
</span><a href="#local-6989586621679100113"><span class="hs-identifier hs-var">movieResults</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-288"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100111"><span class="annot"><span class="annottext">num_movies :: Int
</span><a href="#local-6989586621679100111"><span class="hs-identifier hs-var hs-var">num_movies</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><span class="hs-identifier hs-var">length</span></span><span> </span><span class="annot"><span class="annottext">[Movie]
</span><a href="#local-6989586621679100113"><span class="hs-identifier hs-var">movieResults</span></a></span><span>
</span><span id="line-289"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679100110"><span class="annot"><span class="annottext">latest_movie :: String
</span><a href="#local-6989586621679100110"><span class="hs-identifier hs-var hs-var">latest_movie</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Movie -&gt; String
</span><a href="Types.html#title_"><span class="hs-identifier hs-var">title_</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">last</span></span><span> </span><span class="annot"><span class="annottext">[Movie]
</span><a href="#local-6989586621679100113"><span class="hs-identifier hs-var">movieResults</span></a></span><span>
</span><span id="line-290"></span><span>                </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Year: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100116"><span class="hs-identifier hs-var">year</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nNo. of movies released: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679100111"><span class="hs-identifier hs-var">num_movies</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\nLatest movie: &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. [a] -&gt; [a] -&gt; [a]
</span><span class="hs-operator hs-var">++</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679100110"><span class="hs-identifier hs-var">latest_movie</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Error: this year is not featured in our database&quot;</span></span></pre></body></html>